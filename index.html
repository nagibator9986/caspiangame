<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,maximum-scale=1.0">
<title>Caspian BrainStorm ‚Äî –ö–∞—Å–ø–∏–π—Å–∫–∏–π –ö–æ–ª–ª–µ–¥–∂</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700;800;900&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --cyan:#00e5ff;--mag:#ff0062;--lime:#76ff03;--gold:#ffd600;
  --orange:#ff9100;--purple:#b388ff;--teal:#1de9b6;--sky:#40c4ff;
  --dark:#060e1f;--panel:rgba(10,18,42,.94);
}
html,body{width:100%;height:100%;overflow:hidden;background:var(--dark);color:#fff;font-family:'Exo 2',sans-serif;user-select:none;-webkit-user-select:none;touch-action:none}

/* ========== BACKGROUND ========== */
.bg-grid{position:fixed;inset:0;z-index:0;
  background-image:linear-gradient(rgba(0,229,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,.03) 1px,transparent 1px);
  background-size:50px 50px;animation:gridDrift 30s linear infinite}
@keyframes gridDrift{to{background-position:50px 50px}}
#bgCvs{position:fixed;inset:0;z-index:1;pointer-events:none}

/* ========== SCREENS ========== */
.scr{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;transition:opacity .5s,visibility .5s;padding:16px;overflow-y:auto}
.scr.off{opacity:0;visibility:hidden;pointer-events:none}

/* ========== MENU ========== */
#menu{z-index:110;gap:14px;background:radial-gradient(ellipse at 50% 20%,rgba(0,229,255,.05),transparent 65%)}
.logo{text-align:center;animation:fadeIn .8s both}
.logo h1{font-family:'Orbitron',monospace;font-size:clamp(24px,6.5vw,58px);font-weight:900;line-height:1.15;
  background:linear-gradient(135deg,var(--cyan),var(--teal),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo .sub{font-family:'Orbitron',monospace;font-size:clamp(10px,2.2vw,15px);color:var(--gold);letter-spacing:3px;text-transform:uppercase;margin-top:6px;opacity:.8}
.logo .badge{display:inline-flex;align-items:center;gap:8px;margin-top:14px;padding:8px 22px;
  border:1px solid rgba(255,214,0,.25);border-radius:24px;background:rgba(255,214,0,.05);
  color:var(--gold);font-size:clamp(9px,1.8vw,12px);letter-spacing:1.5px}
.logo .dev{margin-top:10px;font-size:clamp(8px,1.6vw,11px);color:rgba(255,255,255,.35);letter-spacing:1px}
@keyframes fadeIn{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:none}}

.btn{font-family:'Orbitron',monospace;font-weight:700;font-size:clamp(11px,2.6vw,16px);
  padding:16px 36px;border-radius:14px;cursor:pointer;transition:all .2s;
  width:min(340px,88vw);text-align:center;position:relative;overflow:hidden;animation:fadeIn .7s both;border:2px solid}
.btn:active{transform:scale(.96)!important}
.btn.c1{border-color:var(--cyan);color:var(--cyan);background:rgba(0,229,255,.06)}.btn.c1:hover{background:rgba(0,229,255,.15);box-shadow:0 0 30px rgba(0,229,255,.2);transform:translateY(-2px)}
.btn.c2{border-color:var(--mag);color:var(--mag);background:rgba(255,0,98,.05)}.btn.c2:hover{background:rgba(255,0,98,.12);box-shadow:0 0 30px rgba(255,0,98,.2);transform:translateY(-2px)}
.btn.c3{border-color:var(--gold);color:var(--gold);background:rgba(255,214,0,.05)}.btn.c3:hover{background:rgba(255,214,0,.12);box-shadow:0 0 30px rgba(255,214,0,.2);transform:translateY(-2px)}
.btn.c4{border-color:var(--teal);color:var(--teal);background:rgba(29,233,182,.05)}.btn.c4:hover{background:rgba(29,233,182,.12);box-shadow:0 0 30px rgba(29,233,182,.2);transform:translateY(-2px)}
.btn:nth-child(2){animation-delay:.08s}.btn:nth-child(3){animation-delay:.16s}.btn:nth-child(4){animation-delay:.24s}.btn:nth-child(5){animation-delay:.32s}

/* ========== GAME ========== */
#gameArea{position:fixed;inset:0;z-index:50;display:none}
#gameCvs{position:absolute;inset:0;width:100%;height:100%}

.hud{position:absolute;top:0;left:0;right:0;padding:8px 14px;display:flex;justify-content:space-between;align-items:center;
  background:linear-gradient(180deg,rgba(6,14,31,.96) 70%,transparent);z-index:60;gap:8px;flex-wrap:nowrap}
.h-block{display:flex;align-items:center;gap:6px}
.h-icon{font-size:clamp(14px,3vw,20px)}
.h-val{font-family:'Orbitron',monospace;font-weight:900;font-size:clamp(12px,2.8vw,20px)}
.h-lbl{font-size:clamp(7px,1.3vw,9px);text-transform:uppercase;letter-spacing:1px;opacity:.4;font-family:'Orbitron',monospace}
.h-col{display:flex;flex-direction:column;align-items:center}
.vc{color:var(--cyan)}.vg{color:var(--gold)}.vl{color:var(--lime)}.vm{color:var(--mag)}

.energy-wrap{width:clamp(80px,18vw,160px);height:10px;background:rgba(255,255,255,.06);border-radius:5px;overflow:hidden;border:1px solid rgba(29,233,182,.2)}
.energy-fill{height:100%;border-radius:5px;transition:width .3s;background:linear-gradient(90deg,var(--teal),var(--cyan));position:relative}
.energy-fill::after{content:'';position:absolute;inset:0;background:linear-gradient(180deg,rgba(255,255,255,.25),transparent);border-radius:5px}
.energy-fill.low{background:linear-gradient(90deg,var(--mag),var(--orange))}
.energy-fill.mid{background:linear-gradient(90deg,var(--orange),var(--gold))}

.p-btn{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.12);color:#fff;
  font-family:'Orbitron',monospace;font-size:clamp(9px,1.8vw,13px);padding:6px 12px;border-radius:8px;cursor:pointer}

/* ========== QUIZ MODAL ========== */
.qw{position:fixed;inset:0;z-index:200;display:flex;align-items:center;justify-content:center;
  background:rgba(6,14,31,.9);backdrop-filter:blur(14px);padding:12px}
.qw.off{display:none}
.qc{background:linear-gradient(160deg,rgba(12,22,52,.98),rgba(18,12,44,.98));
  border:2px solid var(--cyan);border-radius:22px;padding:clamp(18px,3.5vw,32px);
  width:min(580px,95vw);max-height:90vh;overflow-y:auto;
  box-shadow:0 0 80px rgba(0,229,255,.1),inset 0 1px 0 rgba(255,255,255,.04);animation:pop .3s cubic-bezier(.34,1.56,.64,1)}
@keyframes pop{from{transform:scale(.75);opacity:0}to{transform:none;opacity:1}}

.qc .cat{font-family:'Orbitron',monospace;font-size:clamp(8px,1.6vw,11px);color:var(--gold);letter-spacing:3px;text-transform:uppercase;margin-bottom:6px}
.qc .pts{float:right;background:rgba(29,233,182,.1);border:1px solid rgba(29,233,182,.25);border-radius:8px;padding:3px 10px;
  font-family:'Orbitron',monospace;font-size:clamp(9px,1.5vw,11px);color:var(--teal)}
.qc .qtxt{font-size:clamp(15px,3.2vw,21px);font-weight:700;line-height:1.55;margin:10px 0 18px;clear:both}
.qc .tbar{height:5px;background:rgba(255,255,255,.07);border-radius:3px;margin-bottom:18px;overflow:hidden}
.qc .tfill{height:100%;border-radius:3px;transition:width .12s linear;
  background:linear-gradient(90deg,var(--lime),var(--gold),var(--orange),var(--mag))}
.qg{display:grid;grid-template-columns:1fr 1fr;gap:10px}
@media(max-width:480px){.qg{grid-template-columns:1fr}}
.qo{padding:clamp(13px,2.8vw,18px) 14px;border-radius:14px;font-size:clamp(12px,2.4vw,15px);font-weight:700;
  cursor:pointer;transition:all .15s;text-align:center;line-height:1.4;
  border:2px solid rgba(255,255,255,.08);background:rgba(255,255,255,.02);color:#fff}
.qo:hover{border-color:var(--cyan);background:rgba(0,229,255,.06);transform:translateY(-2px)}
.qo:active{transform:scale(.97)}
.qo.ok{border-color:var(--lime)!important;background:rgba(118,255,3,.12)!important;color:var(--lime)!important;animation:okFlash .5s}
.qo.no{border-color:var(--mag)!important;background:rgba(255,0,98,.1)!important;color:var(--mag)!important;animation:shake .4s}
@keyframes okFlash{0%,100%{box-shadow:none}50%{box-shadow:0 0 40px rgba(118,255,3,.35)}}
@keyframes shake{0%,100%{transform:none}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.qfb{text-align:center;margin-top:14px;font-family:'Orbitron',monospace;font-size:clamp(13px,2.8vw,18px);font-weight:900;animation:fadeIn .3s}

/* ========== GAME OVER ========== */
#gameover{z-index:120;gap:14px;background:radial-gradient(ellipse at 50% 40%,rgba(255,0,98,.04),transparent 55%)}
.go-t{font-family:'Orbitron',monospace;font-size:clamp(28px,7.5vw,64px);font-weight:900;
  background:linear-gradient(135deg,var(--mag),var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;animation:fadeIn .6s both}
.go-s{font-family:'Orbitron',monospace;font-size:clamp(18px,4.5vw,36px);font-weight:900;color:var(--cyan);animation:fadeIn .6s .1s both}
.go-stats{display:flex;gap:16px;flex-wrap:wrap;justify-content:center;animation:fadeIn .6s .2s both}
.go-st{text-align:center;min-width:70px}
.go-st .n{font-family:'Orbitron',monospace;font-size:clamp(14px,3vw,22px);font-weight:700;color:var(--gold)}
.go-st .l{font-size:clamp(8px,1.6vw,11px);opacity:.45;margin-top:2px}
#goInput{font-family:'Orbitron',monospace;font-size:clamp(11px,2.2vw,14px);padding:13px 22px;
  border:2px solid var(--cyan);border-radius:14px;background:rgba(0,229,255,.05);
  color:var(--cyan);text-align:center;width:min(300px,80vw);outline:none;animation:fadeIn .6s .3s both}
#goInput:focus{border-color:var(--teal);box-shadow:0 0 25px rgba(0,229,255,.15)}
#goInput::placeholder{color:rgba(0,229,255,.2)}

/* ========== LEADERBOARD ========== */
#lb{z-index:120;gap:14px}
.lb-h{font-family:'Orbitron',monospace;font-size:clamp(16px,4vw,28px);font-weight:900;color:var(--gold);text-shadow:0 0 25px rgba(255,214,0,.2);animation:fadeIn .5s both}
.lb-s{font-size:clamp(9px,1.8vw,12px);color:rgba(255,255,255,.35);animation:fadeIn .5s .1s both}
.lb-l{width:min(480px,93vw);max-height:52vh;overflow-y:auto;animation:fadeIn .5s .15s both;scrollbar-width:thin;scrollbar-color:var(--cyan) transparent}
.lb-i{display:flex;align-items:center;padding:11px 14px;gap:12px;border-bottom:1px solid rgba(255,255,255,.03);transition:background .2s}
.lb-i:hover{background:rgba(0,229,255,.02)}
.lb-p{font-family:'Orbitron',monospace;font-size:clamp(12px,2.4vw,16px);font-weight:900;width:38px;text-align:center;color:rgba(255,255,255,.3)}
.lb-i:nth-child(1) .lb-p{color:#ffd600;font-size:clamp(16px,3vw,22px)}.lb-i:nth-child(2) .lb-p{color:#b0bec5}.lb-i:nth-child(3) .lb-p{color:#ff8a65}
.lb-inf{flex:1}.lb-n{font-weight:700;font-size:clamp(11px,2.2vw,15px)}.lb-d{font-size:clamp(7px,1.3vw,9px);opacity:.25;margin-top:2px}
.lb-sc{font-family:'Orbitron',monospace;font-size:clamp(11px,2.2vw,15px);font-weight:700;color:var(--cyan)}
.lb-e{text-align:center;padding:36px;color:rgba(255,255,255,.25);font-size:13px}

/* ========== WAVE / TOAST / FLOAT ========== */
.wave-pop{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:80;pointer-events:none;
  font-family:'Orbitron',monospace;font-weight:900;text-align:center;animation:wavAnim 2.5s ease-out forwards}
.wave-pop .wn{font-size:clamp(30px,8vw,60px);color:var(--gold);text-shadow:0 0 50px rgba(255,214,0,.4)}
.wave-pop .ws{font-size:clamp(12px,2.5vw,18px);color:rgba(255,255,255,.5);margin-top:4px}
@keyframes wavAnim{0%{opacity:0;transform:translate(-50%,-50%) scale(.6)}12%{opacity:1;transform:translate(-50%,-50%) scale(1.05)}25%{transform:translate(-50%,-50%) scale(1)}80%{opacity:1}100%{opacity:0;transform:translate(-50%,-50%) translateY(-30px)}}

.toast{position:fixed;top:72px;left:50%;transform:translateX(-50%);z-index:90;
  font-family:'Orbitron',monospace;font-size:clamp(10px,1.8vw,13px);font-weight:700;
  padding:9px 22px;border-radius:10px;pointer-events:none;animation:toastA 2.2s ease-out forwards;white-space:nowrap}
@keyframes toastA{0%{opacity:0;transform:translateX(-50%) translateY(8px)}12%{opacity:1;transform:translateX(-50%)}75%{opacity:1}100%{opacity:0;transform:translateX(-50%) translateY(-16px)}}
.toast.heal{background:rgba(29,233,182,.12);border:1px solid var(--teal);color:var(--teal)}
.toast.freeze{background:rgba(0,229,255,.12);border:1px solid var(--cyan);color:var(--cyan)}
.toast.nuke{background:rgba(255,0,98,.12);border:1px solid var(--mag);color:var(--mag)}
.toast.bonus{background:rgba(255,214,0,.12);border:1px solid var(--gold);color:var(--gold)}
.toast.shield{background:rgba(179,136,255,.12);border:1px solid var(--purple);color:var(--purple)}

/* ========== HOW TO ========== */
#howto{z-index:120;gap:14px;padding:20px}
.ht-t{font-family:'Orbitron',monospace;font-size:clamp(15px,3.5vw,26px);font-weight:900;color:var(--cyan);animation:fadeIn .5s both}
.ht-g{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;width:min(720px,95vw);animation:fadeIn .5s .1s both}
.ht-c{background:var(--panel);border:1px solid rgba(255,255,255,.04);border-radius:14px;padding:16px;text-align:center}
.ht-c .ic{font-size:28px;margin-bottom:6px}
.ht-c h3{font-family:'Orbitron',monospace;font-size:clamp(9px,1.6vw,11px);color:var(--cyan);margin-bottom:5px;letter-spacing:1px}
.ht-c p{font-size:clamp(10px,1.8vw,12px);color:rgba(255,255,255,.5);line-height:1.55}
</style>
</head>
<body>

<div class="bg-grid"></div>
<canvas id="bgCvs"></canvas>

<!-- ===================== MENU ===================== -->
<div id="menu" class="scr">
  <div class="logo">
    <h1>CASPIAN<br>BRAINSTORM</h1>
    <div class="sub">‚ö° –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –∞—Ä–µ–Ω–∞ ‚ö°</div>
    <div class="badge">üèõ –ö–∞—Å–ø–∏–π—Å–∫–∏–π –ö–æ–ª–ª–µ–¥–∂ ‚Ä¢ IT –î–µ–∫–∞–¥–∞ 2026</div>
    <div class="dev">–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–æ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º –¢–ª–µ—É–±–µ–∫–æ–≤ –ê.–ì.</div>
  </div>
  <button class="btn c1" onclick="G.start()">üß† –ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
  <button class="btn c2" onclick="showScr('lb')">üèÜ –†–ï–ö–û–†–î–´</button>
  <button class="btn c3" onclick="showScr('howto')">üìñ –ö–ê–ö –ò–ì–†–ê–¢–¨</button>
</div>

<!-- ===================== HOW TO PLAY ===================== -->
<div id="howto" class="scr off">
  <div class="ht-t">üìñ –ö–ê–ö –ò–ì–†–ê–¢–¨</div>
  <div class="ht-g">
    <div class="ht-c"><div class="ic">üéØ</div><h3>–ù–ê–ñ–ò–ú–ê–ô –ù–ê –°–§–ï–†–´</h3><p>–°—Ñ–µ—Ä—ã –∑–Ω–∞–Ω–∏–π –ª–µ—Ç—è—Ç –∫ —è–¥—Ä—É. –ù–∞–∂–º–∏ –Ω–∞ —Å—Ñ–µ—Ä—É ‚Äî –ø–æ—è–≤–∏—Ç—Å—è –≤–æ–ø—Ä–æ—Å. –û—Ç–≤–µ—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ ‚Äî —É–Ω–∏—á—Ç–æ–∂—å –µ—ë –∏ –ø–æ–ª—É—á–∏ –æ—á–∫–∏!</p></div>
    <div class="ht-c"><div class="ic">‚è±Ô∏è</div><h3>–í–†–ï–ú–Ø –ù–ê –û–¢–í–ï–¢</h3><p>–£ –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –µ—Å—Ç—å —Ç–∞–π–º–µ—Ä. –ù–µ —É—Å–ø–µ–ª ‚Äî —Å—Ñ–µ—Ä–∞ –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω —è–¥—Ä—É. –ß–µ–º –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç, —Ç–µ–º –±–æ–ª—å—à–µ –±–æ–Ω—É—Å!</p></div>
    <div class="ht-c"><div class="ic">üî•</div><h3>–ö–û–ú–ë–û –°–ï–†–ò–Ø</h3><p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–¥—Ä—è–¥ —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –º–Ω–æ–∂–∏—Ç–µ–ª—å –æ—á–∫–æ–≤ –¥–æ x10! –û—à–∏–±–∫–∞ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∫–æ–º–±–æ.</p></div>
    <div class="ht-c"><div class="ic">üåä</div><h3>–í–û–õ–ù–´</h3><p>–ö–∞–∂–¥–∞—è –≤–æ–ª–Ω–∞ —Å–ª–æ–∂–Ω–µ–µ ‚Äî –±–æ–ª—å—à–µ —Å—Ñ–µ—Ä, –±—ã—Å—Ç—Ä–µ–µ –¥–≤–∏–∂—É—Ç—Å—è, –≤–æ–ø—Ä–æ—Å—ã —Ç—Ä—É–¥–Ω–µ–µ. –°–∫–æ–ª—å–∫–æ –≤–æ–ª–Ω –ø—Ä–æ–¥–µ—Ä–∂–∏—à—å—Å—è?</p></div>
    <div class="ht-c"><div class="ic">üéÅ</div><h3>–ë–û–ù–£–°–´</h3><p>–ó–∞ —Å–µ—Ä–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—É—á–∞–π –±–æ–Ω—É—Å—ã: –ª–µ—á–µ–Ω–∏–µ —è–¥—Ä–∞, –∑–∞–º–æ—Ä–æ–∑–∫—É, –≤–∑—Ä—ã–≤ –≤—Å–µ—Ö —Å—Ñ–µ—Ä, —â–∏—Ç!</p></div>
    <div class="ht-c"><div class="ic">üí°</div><h3>–ö–ê–¢–ï–ì–û–†–ò–ò</h3><p>–ù–∞—É–∫–∞, –∏—Å—Ç–æ—Ä–∏—è, IT, –ª–æ–≥–∏–∫–∞, –≥–µ–æ–≥—Ä–∞—Ñ–∏—è, –∫—É–ª—å—Ç—É—Ä–∞ ‚Äî –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –≤—Å–µ—Ö! –ü—Ä–æ–≤–µ—Ä—å —Å–≤–æ—é —ç—Ä—É–¥–∏—Ü–∏—é!</p></div>
  </div>
  <button class="btn c1" onclick="showScr('menu')" style="margin-top:10px">‚Üê –ù–ê–ó–ê–î</button>
</div>

<!-- ===================== GAME ===================== -->
<div id="gameArea">
  <canvas id="gameCvs"></canvas>
  <div class="hud">
    <div class="h-block">
      <div class="h-col"><span class="h-icon">‚ö°</span><span class="h-lbl">–û—á–∫–∏</span></div>
      <span class="h-val vc" id="hScore">0</span>
    </div>
    <div class="h-block">
      <div class="h-col"><span class="h-icon">üî•</span><span class="h-lbl">–ö–æ–º–±–æ</span></div>
      <span class="h-val vl" id="hCombo">x1</span>
    </div>
    <div class="h-block">
      <div class="h-col"><span class="h-icon">üåä</span><span class="h-lbl">–í–æ–ª–Ω–∞</span></div>
      <span class="h-val vg" id="hWave">1</span>
    </div>
    <div class="h-block">
      <div class="energy-wrap"><div class="energy-fill" id="hpBar" style="width:100%"></div></div>
    </div>
    <button class="p-btn" onclick="G.pause()">‚è∏</button>
  </div>
</div>

<!-- ===================== QUIZ ===================== -->
<div class="qw off" id="qWrap">
  <div class="qc">
    <div class="cat" id="qCat">–í–û–ü–†–û–°</div>
    <span class="pts" id="qPts">+50</span>
    <div class="qtxt" id="qTxt"></div>
    <div class="tbar"><div class="tfill" id="qBar" style="width:100%"></div></div>
    <div class="qg" id="qGrid"></div>
    <div class="qfb" id="qFb" style="display:none"></div>
  </div>
</div>

<!-- ===================== GAME OVER ===================== -->
<div id="gameover" class="scr off">
  <div class="go-t">–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê</div>
  <div class="go-s" id="goSc">0</div>
  <div class="go-stats">
    <div class="go-st"><div class="n" id="goW">0</div><div class="l">–í–æ–ª–Ω</div></div>
    <div class="go-st"><div class="n" id="goK">0</div><div class="l">–í–µ—Ä–Ω—ã—Ö</div></div>
    <div class="go-st"><div class="n" id="goX">0</div><div class="l">–ú–∞–∫—Å –∫–æ–º–±–æ</div></div>
    <div class="go-st"><div class="n" id="goA">0%</div><div class="l">–¢–æ—á–Ω–æ—Å—Ç—å</div></div>
  </div>
  <input type="text" id="goInput" placeholder="–í–í–ï–î–ò–¢–ï –ò–ú–Ø" maxlength="20">
  <button class="btn c1" onclick="G.save()">üíæ –°–û–•–†–ê–ù–ò–¢–¨</button>
  <button class="btn c4" onclick="G.start()">üîÑ –ó–ê–ù–û–í–û</button>
  <button class="btn c3" onclick="showScr('menu')">üè† –ú–ï–ù–Æ</button>
</div>

<!-- ===================== LEADERBOARD ===================== -->
<div id="lb" class="scr off">
  <div class="lb-h">üèÜ –¢–û–ü –ò–ì–†–û–ö–ò</div>
  <div class="lb-s">–ö–∞—Å–ø–∏–π—Å–∫–∏–π –ö–æ–ª–ª–µ–¥–∂ ‚Ä¢ –ö–∞—Ñ–µ–¥—Ä–∞ IT</div>
  <div class="lb-l" id="lbList"></div>
  <button class="btn c1" onclick="showScr('menu')" style="margin-top:10px">‚Üê –ù–ê–ó–ê–î</button>
</div>

<script>
// ==================== HELPERS ====================
const $=id=>document.getElementById(id);
function showScr(id){document.querySelectorAll('.scr').forEach(s=>s.classList.add('off'));$('gameArea').style.display='none';if(id&&$(id))$(id).classList.remove('off');if(id==='lb')renderLB()}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML}
function rnd(a,b){return a+Math.random()*(b-a)}
function dst(a,b){return Math.hypot(b.x-a.x,b.y-a.y)}
function lerp(a,b,t){return a+(b-a)*t}

// ==================== BG PARTICLES ====================
const bgC=$('bgCvs'),bgX=bgC.getContext('2d');let bgP=[];
function initBG(){bgC.width=innerWidth;bgC.height=innerHeight;bgP=Array.from({length:50},()=>({x:rnd(0,bgC.width),y:rnd(0,bgC.height),r:rnd(.4,1.8),dx:rnd(-.15,.15),dy:rnd(-.25,-.04),a:rnd(0,6.3)}))}
function drawBG(){bgX.clearRect(0,0,bgC.width,bgC.height);bgP.forEach(p=>{p.x+=p.dx;p.y+=p.dy;p.a+=.015;if(p.y<-4){p.y=bgC.height+4;p.x=rnd(0,bgC.width)}if(p.x<-4)p.x=bgC.width;if(p.x>bgC.width+4)p.x=0;bgX.beginPath();bgX.arc(p.x,p.y,p.r,0,6.28);bgX.fillStyle=`rgba(0,229,255,${.1+.08*Math.sin(p.a)})`;bgX.fill()});requestAnimationFrame(drawBG)}
initBG();drawBG();addEventListener('resize',()=>{initBG();if(G.on)G.resize()});

// ==================== QUESTIONS (60 universal) ====================
const Q=[
  // IT & –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
  {c:"üíª IT",q:"–ß—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä–∞ HTML?",o:["HyperText Markup Language","High Technical Mode Language","Home Text Machine Logic","Hyper Transfer Meta Language"],a:0},
  {c:"üíª IT",q:"–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ?",o:["–§–ª–µ—à–∫–∞ –≤ –æ–±–ª–∞–∫–µ","–•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö","–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã","–¢–∏–ø –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞"],a:1},
  {c:"üíª IT",q:"–ö—Ç–æ –æ—Å–Ω–æ–≤–∞–ª –∫–æ–º–ø–∞–Ω–∏—é Apple?",o:["–ë–∏–ª–ª –ì–µ–π—Ç—Å","–ú–∞—Ä–∫ –¶—É–∫–µ—Ä–±–µ—Ä–≥","–°—Ç–∏–≤ –î–∂–æ–±—Å","–ò–ª–æ–Ω –ú–∞—Å–∫"],a:2},
  {c:"üíª IT",q:"–ß—Ç–æ —Ç–∞–∫–æ–µ Wi-Fi?",o:["–¢–∏–ø –∫–∞–±–µ–ª—è","–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è —Å–≤—è–∑–∏","–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è","–°–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å"],a:1},
  {c:"üíª IT",q:"–ö–∞–∫–∞—è —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è —Å–µ—Ç—å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ú–∞—Ä–∫—É –¶—É–∫–µ—Ä–±–µ—Ä–≥—É?",o:["Twitter","TikTok","Facebook","Telegram"],a:2},
  {c:"üíª IT",q:"–ß—Ç–æ —Ç–∞–∫–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç?",o:["–†–æ–±–æ—Ç","–ú–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º—ã—à–ª–µ–Ω–∏—è –º–∞—à–∏–Ω–æ–π","–ê–Ω—Ç–∏–≤–∏—Ä—É—Å","–¢–∏–ø –∫–æ–º–ø—å—é—Ç–µ—Ä–∞"],a:1},
  {c:"üíª IT",q:"–°–∫–æ–ª—å–∫–æ –±–∞–π—Ç –≤ –æ–¥–Ω–æ–º –∫–∏–ª–æ–±–∞–π—Ç–µ?",o:["100","512","1024","1000"],a:2},
  {c:"üíª IT",q:"–ß—Ç–æ –¥–µ–ª–∞–µ—Ç Ctrl+Z?",o:["–ö–æ–ø–∏—Ä—É–µ—Ç","–í—Å—Ç–∞–≤–ª—è–µ—Ç","–û—Ç–º–µ–Ω—è–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ","–°–æ—Ö—Ä–∞–Ω—è–µ—Ç"],a:2},

  // –ù–∞—É–∫–∞
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–ö–∞–∫–æ–π –≥–∞–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –¥—ã—Ö–∞–Ω–∏—è?",o:["–ê–∑–æ—Ç","–£–≥–ª–µ–∫–∏—Å–ª—ã–π –≥–∞–∑","–ö–∏—Å–ª–æ—Ä–æ–¥","–ì–µ–ª–∏–π"],a:2},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–°–∫–æ—Ä–æ—Å—Ç—å —Å–≤–µ—Ç–∞ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–≤–Ω–∞?",o:["300 000 –∫–º/—Å","150 000 –∫–º/—Å","1 000 000 –∫–º/—Å","30 000 –∫–º/—Å"],a:0},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–ö–∞–∫–æ–π —ç–ª–µ–º–µ–Ω—Ç –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç—Å—è —Å–∏–º–≤–æ–ª–æ–º Fe?",o:["–§—Ç–æ—Ä","–§–æ—Å—Ñ–æ—Ä","–ñ–µ–ª–µ–∑–æ","–§—Ä–∞–Ω—Ü–∏–π"],a:2},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–ß—Ç–æ –∏–∑—É—á–∞–µ—Ç –±–æ—Ç–∞–Ω–∏–∫–∞?",o:["–ñ–∏–≤–æ—Ç–Ω—ã—Ö","–†–∞—Å—Ç–µ–Ω–∏—è","–ú–∏–Ω–µ—Ä–∞–ª—ã","–ó–≤—ë–∑–¥—ã"],a:1},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–§–æ—Ä–º—É–ª–∞ –≤–æ–¥—ã?",o:["CO2","H2O","NaCl","O2"],a:1},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–ö—Ç–æ –æ—Ç–∫—Ä—ã–ª –∑–∞–∫–æ–Ω –≤—Å–µ–º–∏—Ä–Ω–æ–≥–æ —Ç—è–≥–æ—Ç–µ–Ω–∏—è?",o:["–≠–π–Ω—à—Ç–µ–π–Ω","–ù—å—é—Ç–æ–Ω","–¢–µ—Å–ª–∞","–ì–∞–ª–∏–ª–µ–π"],a:1},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø–ª–∞–Ω–µ—Ç–∞ –°–æ–ª–Ω–µ—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã?",o:["–°–∞—Ç—É—Ä–Ω","–ó–µ–º–ª—è","–Æ–ø–∏—Ç–µ—Ä","–ù–µ–ø—Ç—É–Ω"],a:2},
  {c:"üî¨ –ù–∞—É–∫–∞",q:"–ß—Ç–æ —Ç–∞–∫–æ–µ –î–ù–ö?",o:["–¢–∏–ø —ç–Ω–µ—Ä–≥–∏–∏","–ù–æ—Å–∏—Ç–µ–ª—å –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏","–•–∏–º–∏—á–µ—Å–∫–∏–π —ç–ª–µ–º–µ–Ω—Ç","–í–∏–¥ –±–∞–∫—Ç–µ—Ä–∏–∏"],a:1},

  // –ò—Å—Ç–æ—Ä–∏—è
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–í –∫–∞–∫–æ–º –≥–æ–¥—É —á–µ–ª–æ–≤–µ–∫ –≤–ø–µ—Ä–≤—ã–µ –ø–æ–ª–µ—Ç–µ–ª –≤ –∫–æ—Å–º–æ—Å?",o:["1957","1961","1969","1955"],a:1},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–ö—Ç–æ –±—ã–ª –ø–µ—Ä–≤—ã–º –∫–æ—Å–º–æ–Ω–∞–≤—Ç–æ–º?",o:["–ù–∏–ª –ê—Ä–º—Å—Ç—Ä–æ–Ω–≥","–Æ—Ä–∏–π –ì–∞–≥–∞—Ä–∏–Ω","–í–∞–ª–µ–Ω—Ç–∏–Ω–∞ –¢–µ—Ä–µ—à–∫–æ–≤–∞","–ê–ª–∞–Ω –®–µ–ø–∞—Ä–¥"],a:1},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–í –∫–∞–∫–æ–º –≥–æ–¥—É –Ω–∞—á–∞–ª–∞—Å—å –í—Ç–æ—Ä–∞—è –º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞?",o:["1935","1939","1941","1938"],a:1},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–ö–∞–∫–∞—è –¥—Ä–µ–≤–Ω—è—è —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏—è –ø–æ—Å—Ç—Ä–æ–∏–ª–∞ –ø–∏—Ä–∞–º–∏–¥—ã?",o:["–†–∏–º–ª—è–Ω–µ","–ì—Ä–µ–∫–∏","–ï–≥–∏–ø—Ç—è–Ω–µ","–í–∞–≤–∏–ª–æ–Ω—è–Ω–µ"],a:2},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª ¬´–ú–æ–Ω–∞ –õ–∏–∑—É¬ª?",o:["–ú–∏–∫–µ–ª–∞–Ω–¥–∂–µ–ª–æ","–†–∞—Ñ–∞—ç–ª—å","–õ–µ–æ–Ω–∞—Ä–¥–æ –¥–∞ –í–∏–Ω—á–∏","–†–µ–º–±—Ä–∞–Ω–¥—Ç"],a:2},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–í –∫–∞–∫–æ–º –≥–æ–¥—É –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω –æ–±—Ä—ë–ª –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å?",o:["1989","1990","1991","1993"],a:2},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–°—Ç–æ–ª–∏—Ü–∞ –†–∏–º—Å–∫–æ–π –∏–º–ø–µ—Ä–∏–∏?",o:["–ê—Ñ–∏–Ω—ã","–†–∏–º","–°–ø–∞—Ä—Ç–∞","–ö–∞—Ä—Ñ–∞–≥–µ–Ω"],a:1},
  {c:"üìú –ò—Å—Ç–æ—Ä–∏—è",q:"–ö—Ç–æ –∏–∑–æ–±—Ä—ë–ª –∫–Ω–∏–≥–æ–ø–µ—á–∞—Ç–∞–Ω–∏–µ?",o:["–õ–µ–æ–Ω–∞—Ä–¥–æ","–ì—É—Ç–µ–Ω–±–µ—Ä–≥","–ù—å—é—Ç–æ–Ω","–ö–æ–ø–µ—Ä–Ω–∏–∫"],a:1},

  // –ì–µ–æ–≥—Ä–∞—Ñ–∏—è
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–°–∞–º—ã–π –±–æ–ª—å—à–æ–π –æ–∫–µ–∞–Ω –Ω–∞ –ó–µ–º–ª–µ?",o:["–ê—Ç–ª–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π","–ò–Ω–¥–∏–π—Å–∫–∏–π","–¢–∏—Ö–∏–π","–°–µ–≤–µ—Ä–Ω—ã–π –õ–µ–¥–æ–≤–∏—Ç—ã–π"],a:2},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–°—Ç–æ–ª–∏—Ü–∞ –Ø–ø–æ–Ω–∏–∏?",o:["–ü–µ–∫–∏–Ω","–°–µ—É–ª","–¢–æ–∫–∏–æ","–ë–∞–Ω–≥–∫–æ–∫"],a:2},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ä–µ–∫–∞ –≤ –º–∏—Ä–µ?",o:["–ú–∏—Å—Å–∏—Å–∏–ø–∏","–ê–º–∞–∑–æ–Ω–∫–∞","–ù–∏–ª","–í–æ–ª–≥–∞"],a:2},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–ù–∞ –∫–∞–∫–æ–º –º–∞—Ç–µ—Ä–∏–∫–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω?",o:["–ï–≤—Ä–æ–ø–∞","–ê–∑–∏—è","–ï–≤—Ä–∞–∑–∏—è","–ê—Ñ—Ä–∏–∫–∞"],a:2},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–ö–∞–∫–∞—è —Å–∞–º–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è —Å—Ç—Ä–∞–Ω–∞ –≤ –º–∏—Ä–µ?",o:["–ú–æ–Ω–∞–∫–æ","–õ—é–∫—Å–µ–º–±—É—Ä–≥","–í–∞—Ç–∏–∫–∞–Ω","–ú–∞–ª—å—Ç–∞"],a:2},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–°–∞–º–∞—è –≤—ã—Å–æ–∫–∞—è –≥–æ—Ä–∞ –≤ –º–∏—Ä–µ?",o:["–ö–∏–ª–∏–º–∞–Ω–¥–∂–∞—Ä–æ","–ö2","–≠–≤–µ—Ä–µ—Å—Ç","–≠–ª—å–±—Ä—É—Å"],a:2},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–°—Ç–æ–ª–∏—Ü–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞?",o:["–ê–ª–º–∞—Ç—ã","–ê—Å—Ç–∞–Ω–∞","–®—ã–º–∫–µ–Ω—Ç","–ö–∞—Ä–∞–≥–∞–Ω–¥–∞"],a:1},
  {c:"üåç –ì–µ–æ–≥—Ä–∞—Ñ–∏—è",q:"–°–∫–æ–ª—å–∫–æ –º–∞—Ç–µ—Ä–∏–∫–æ–≤ –Ω–∞ –ó–µ–º–ª–µ?",o:["5","6","7","4"],a:1},

  // –õ–æ–≥–∏–∫–∞ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ß–µ–º—É —Ä–∞–≤–Ω–æ 15% –æ—Ç 200?",o:["25","30","35","20"],a:1},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ß—Ç–æ —Å–ª–µ–¥—É—é—â–µ–µ: 2, 6, 18, 54, ...?",o:["108","162","72","96"],a:1},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–°–∫–æ–ª—å–∫–æ –≥—Ä–∞–¥—É—Å–æ–≤ –≤ –ø—Ä—è–º–æ–º —É–≥–ª–µ?",o:["45¬∞","90¬∞","180¬∞","360¬∞"],a:1},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ö–æ—Ä–µ–Ω—å –∏–∑ 144?",o:["14","11","12","13"],a:2},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ï—Å–ª–∏ 3 –∫–æ—à–∫–∏ –ª–æ–≤—è—Ç 3 –º—ã—à–µ–π –∑–∞ 3 –º–∏–Ω—É—Ç—ã, –∑–∞ —Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç 100 –∫–æ—à–µ–∫ –ø–æ–π–º–∞—é—Ç 100 –º—ã—à–µ–π?",o:["100 –º–∏–Ω—É—Ç","1 –º–∏–Ω—É—Ç–∞","3 –º–∏–Ω—É—Ç—ã","33 –º–∏–Ω—É—Ç—ã"],a:2},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ß–µ–º—É —Ä–∞–≤–Ω–æ 2^10?",o:["512","1024","2048","256"],a:1},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ö–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π: 1, 1, 2, 3, 5, 8, ...?",o:["11","12","13","10"],a:2},
  {c:"üßÆ –õ–æ–≥–∏–∫–∞",q:"–ü–ª–æ—â–∞–¥—å –∫—Ä—É–≥–∞ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –ø–æ —Ñ–æ—Ä–º—É–ª–µ?",o:["2œÄr","œÄr¬≤","œÄd","r¬≤"],a:1},

  // –ö—É–ª—å—Ç—É—Ä–∞ –∏ –æ–±—â–∏–µ
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–ö—Ç–æ –Ω–∞–ø–∏—Å–∞–ª ¬´–í–æ–π–Ω—É –∏ –º–∏—Ä¬ª?",o:["–î–æ—Å—Ç–æ–µ–≤—Å–∫–∏–π","–ü—É—à–∫–∏–Ω","–¢–æ–ª—Å—Ç–æ–π","–ß–µ—Ö–æ–≤"],a:2},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–°–∫–æ–ª—å–∫–æ –Ω–æ—Ç –≤ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–π –≥–∞–º–º–µ?",o:["5","6","7","8"],a:2},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–ö–∞–∫–æ–π —è–∑—ã–∫ —Å–∞–º—ã–π —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π –≤ –º–∏—Ä–µ?",o:["–ê–Ω–≥–ª–∏–π—Å–∫–∏–π","–ò—Å–ø–∞–Ω—Å–∫–∏–π","–ö–∏—Ç–∞–π—Å–∫–∏–π","–•–∏–Ω–¥–∏"],a:2},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–ê–≤—Ç–æ—Ä ¬´–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä–∞¬ª?",o:["–°—Ç–∏–≤–µ–Ω –ö–∏–Ω–≥","–¢–æ–ª–∫–∏–Ω","–î–∂. –ö. –†–æ—É–ª–∏–Ω–≥","–î–∂–æ—Ä–¥–∂ –ú–∞—Ä—Ç–∏–Ω"],a:2},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–ö–∞–∫–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∏–º–µ–µ—Ç 88 –∫–ª–∞–≤–∏—à?",o:["–ì–∏—Ç–∞—Ä–∞","–°–∫—Ä–∏–ø–∫–∞","–§–æ—Ä—Ç–µ–ø–∏–∞–Ω–æ","–ê–∫–∫–æ—Ä–¥–µ–æ–Ω"],a:2},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–û–ª–∏–º–ø–∏–π—Å–∫–∏–µ –∏–≥—Ä—ã –ø—Ä–æ–≤–æ–¥—è—Ç—Å—è —Ä–∞–∑ –≤?",o:["2 –≥–æ–¥–∞","3 –≥–æ–¥–∞","4 –≥–æ–¥–∞","5 –ª–µ—Ç"],a:2},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–ê–±–∞–π –ö—É–Ω–∞–Ω–±–∞–µ–≤ ‚Äî —ç—Ç–æ...?",o:["–ö–æ–º–ø–æ–∑–∏—Ç–æ—Ä","–ü–æ—ç—Ç –∏ –º—ã—Å–ª–∏—Ç–µ–ª—å","–£—á—ë–Ω—ã–π","–ü–æ–ª–∏—Ç–∏–∫"],a:1},
  {c:"üé≠ –ö—É–ª—å—Ç—É—Ä–∞",q:"–°–∫–æ–ª—å–∫–æ –∏–≥—Ä–æ–∫–æ–≤ –≤ —Ñ—É—Ç–±–æ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–µ –Ω–∞ –ø–æ–ª–µ?",o:["9","10","11","12"],a:2},

  // –ü—Ä–∏—Ä–æ–¥–∞ –∏ –º–∏—Ä
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–°–∞–º–æ–µ –±—ã—Å—Ç—Ä–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ –Ω–∞ —Å—É—à–µ?",o:["–õ–µ–≤","–ì–µ–ø–∞—Ä–¥","–ê–Ω—Ç–∏–ª–æ–ø–∞","–°—Ç—Ä–∞—É—Å"],a:1},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–°–∫–æ–ª—å–∫–æ –∫–æ—Å—Ç–µ–π –≤ —Ç–µ–ª–µ –≤–∑—Ä–æ—Å–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?",o:["186","206","256","196"],a:1},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–ö–∞–∫–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ —Å–∞–º–æ–µ –∫—Ä—É–ø–Ω–æ–µ –Ω–∞ –ó–µ–º–ª–µ?",o:["–°–ª–æ–Ω","–ñ–∏—Ä–∞—Ñ","–°–∏–Ω–∏–π –∫–∏—Ç","–ê–∫—É–ª–∞"],a:2},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–°–∫–æ–ª—å–∫–æ –∫–∞–º–µ—Ä –≤ —Å–µ—Ä–¥—Ü–µ —á–µ–ª–æ–≤–µ–∫–∞?",o:["2","3","4","5"],a:2},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–ß—Ç–æ –≤—ã—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç —Ä–∞—Å—Ç–µ–Ω–∏—è –ø—Ä–∏ —Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑–µ?",o:["CO2","–ê–∑–æ—Ç","–ö–∏—Å–ª–æ—Ä–æ–¥","–í–æ–¥–æ—Ä–æ–¥"],a:2},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–°–∞–º–∞—è –±–æ–ª—å—à–∞—è –ø—É—Å—Ç—ã–Ω—è –≤ –º–∏—Ä–µ?",o:["–ì–æ–±–∏","–ö–∞—Ä–∞–∫—É–º—ã","–°–∞—Ö–∞—Ä–∞","–ê—Ä–∞–≤–∏–π—Å–∫–∞—è"],a:2},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–ö–∞–∫–æ–π –æ—Ä–≥–∞–Ω —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∫—Ä–æ–≤—å?",o:["–°–µ—Ä–¥—Ü–µ","–ü–µ—á–µ–Ω—å","–ü–æ—á–∫–∏","–õ—ë–≥–∫–∏–µ"],a:2},
  {c:"üåø –ü—Ä–∏—Ä–æ–¥–∞",q:"–ê–ª–º–∞–∑ ‚Äî —ç—Ç–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º–∞?",o:["–ö—Ä–µ–º–Ω–∏—è","–£–≥–ª–µ—Ä–æ–¥–∞","–ñ–µ–ª–µ–∑–∞","–ö–≤–∞—Ä—Ü–∞"],a:1},

  // –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω
  {c:"üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",q:"–ö–∞–∫–æ–µ –æ–∑–µ—Ä–æ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–º—ã–º –±–æ–ª—å—à–∏–º –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ?",o:["–ë–∞–ª—Ö–∞—à","–ê–ª–∞–∫–æ–ª—å","–ö–∞—Å–ø–∏–π—Å–∫–æ–µ","–ó–∞–π—Å–∞–Ω"],a:0},
  {c:"üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",q:"–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª—é—Ç–∞ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞?",o:["–°–æ–º","–†—É–±–ª—å","–¢–µ–Ω–≥–µ","–ú–∞–Ω–∞—Ç"],a:2},
  {c:"üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",q:"–ö–æ—Å–º–æ–¥—Ä–æ–º –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è?",o:["–í–æ—Å—Ç–æ—á–Ω—ã–π","–ë–∞–π–∫–æ–Ω—É—Ä","–ü–ª–µ—Å–µ—Ü–∫","–ö–∞–Ω–∞–≤–µ—Ä–∞–ª"],a:1},
  {c:"üá∞üáø –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω",q:"–°–∞–º—ã–π –∫—Ä—É–ø–Ω—ã–π –≥–æ—Ä–æ–¥ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞?",o:["–ê—Å—Ç–∞–Ω–∞","–®—ã–º–∫–µ–Ω—Ç","–ê–ª–º–∞—Ç—ã","–ö–∞—Ä–∞–≥–∞–Ω–¥–∞"],a:2},
];

// ==================== LEADERBOARD ====================
function getLB(){try{return JSON.parse(localStorage.getItem('caspian_bs_lb')||'[]')}catch{return[]}}
function saveLB(d){localStorage.setItem('caspian_bs_lb',JSON.stringify(d))}
function renderLB(){
  const lb=getLB().sort((a,b)=>b.s-a.s).slice(0,30);const el=$('lbList');
  if(!lb.length){el.innerHTML='<div class="lb-e">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤. –ë—É–¥—å –ø–µ—Ä–≤—ã–º! üß†</div>';return}
  el.innerHTML=lb.map((e,i)=>{
    const m=i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':`${i+1}`;
    return `<div class="lb-i"><span class="lb-p">${m}</span><div class="lb-inf"><div class="lb-n">${esc(e.n)}</div><div class="lb-d">–í–æ–ª–Ω–∞ ${e.w||'?'} ‚Ä¢ ${e.d||''}</div></div><span class="lb-sc">${e.s}</span></div>`
  }).join('');
}

// ==================== TOASTS / BANNERS ====================
function toast(t,c){const e=document.createElement('div');e.className='toast '+c;e.textContent=t;document.body.appendChild(e);setTimeout(()=>e.remove(),2400)}
function waveBanner(w,sub){
  const e=document.createElement('div');e.className='wave-pop';
  e.innerHTML=`<div class="wn">–í–û–õ–ù–ê ${w}</div><div class="ws">${sub||''}</div>`;
  document.body.appendChild(e);setTimeout(()=>e.remove(),2800);
}

// ==================== GAME ENGINE ====================
const gc=$('gameCvs'),gx=gc.getContext('2d');
const COLORS=['#00e5ff','#76ff03','#ffd600','#ff9100','#ff0062','#d500f9','#b388ff','#1de9b6','#40c4ff','#ff4081'];
const ICONS=['üß¨','‚öõÔ∏è','üîÆ','üíé','üåÄ','‚ú®','ü™ê','üî∑','üßä','üåü','üí´','üéØ','üì°','üî¨','üß™'];

const G={
  on:false,paused:false,
  score:0,hp:100,wave:1,combo:1,maxCombo:1,
  correct:0,wrong:0,
  orbs:[],particles:[],floats:[],
  spawnT:0,spawnI:110,waveN:0,waveMax:6,waveDelay:0,
  frozen:false,freezeT:0,shielded:false,shieldT:0,
  cx:0,cy:0,coreR:0,time:0,
  usedQ:new Set(),

  resize(){
    const d=Math.min(devicePixelRatio,2);
    gc.width=innerWidth*d;gc.height=innerHeight*d;
    gc.style.width=innerWidth+'px';gc.style.height=innerHeight+'px';
    gx.setTransform(d,0,0,d,0,0);
    this.cx=innerWidth/2;this.cy=innerHeight/2;
    this.coreR=Math.min(innerWidth,innerHeight)*.065;
  },

  start(){
    showScr(null);$('gameArea').style.display='block';
    this.resize();this.on=true;this.paused=false;
    this.score=0;this.hp=100;this.wave=1;this.combo=1;this.maxCombo=1;
    this.correct=0;this.wrong=0;
    this.orbs=[];this.particles=[];this.floats=[];
    this.spawnT=0;this.spawnI=110;this.waveN=0;this.waveMax=6;this.waveDelay=140;
    this.frozen=false;this.freezeT=0;this.shielded=false;this.shieldT=0;this.time=0;
    this.usedQ.clear();
    waveBanner(1,'–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å!');
    this.hud();requestAnimationFrame(()=>this.loop());
  },

  pause(){if(!this.on)return;this.paused=!this.paused;if(!this.paused)requestAnimationFrame(()=>this.loop())},

  loop(){
    if(!this.on||this.paused)return;
    this.time++;
    const W=innerWidth,H=innerHeight;
    gx.clearRect(0,0,W,H);

    // BG
    const bg=gx.createRadialGradient(this.cx,this.cy,0,this.cx,this.cy,Math.max(W,H)*.55);
    bg.addColorStop(0,'#0a1230');bg.addColorStop(1,'#040810');gx.fillStyle=bg;gx.fillRect(0,0,W,H);

    // Radar rings
    const maxRing=Math.max(W,H)*.5;
    for(let i=1;i<=6;i++){
      gx.beginPath();gx.arc(this.cx,this.cy,this.coreR+i*(maxRing/6),0,6.28);
      gx.strokeStyle=`rgba(0,229,255,${.02+.008*i})`;gx.lineWidth=1;gx.stroke();
    }

    // Radar sweep
    gx.save();gx.translate(this.cx,this.cy);gx.rotate(this.time*.008);
    const sw=gx.createConicGradient(0,0,0);
    sw.addColorStop(0,'rgba(0,229,255,.06)');sw.addColorStop(.12,'rgba(0,229,255,0)');sw.addColorStop(1,'rgba(0,229,255,0)');
    gx.fillStyle=sw;gx.beginPath();gx.arc(0,0,maxRing,0,6.28);gx.fill();gx.restore();

    // Freeze overlay
    if(this.frozen){gx.fillStyle='rgba(0,229,255,.03)';gx.fillRect(0,0,W,H);this.freezeT--;if(this.freezeT<=0)this.frozen=false}

    // Shield timer
    if(this.shielded){this.shieldT--;if(this.shieldT<=0)this.shielded=false}

    this.drawCore();

    // Spawn
    const sm=this.frozen?.25:1;
    if(this.waveDelay>0){this.waveDelay--}
    else if(this.waveN<this.waveMax){
      this.spawnT++;
      if(this.spawnT>=this.spawnI){this.spawnT=0;this.spawnOrb();this.waveN++}
    }else if(this.orbs.length===0){this.nextWave()}

    // Update orbs
    for(let i=this.orbs.length-1;i>=0;i--){
      const o=this.orbs[i];
      const ang=Math.atan2(this.cy-o.y,this.cx-o.x);
      const spd=o.speed*sm;
      o.x+=Math.cos(ang)*spd;o.y+=Math.sin(ang)*spd;
      o.pulse=(o.pulse||0)+.04;o.rot=(o.rot||0)+.01;

      if(dst(o,{x:this.cx,y:this.cy})<this.coreR+o.r*.5){
        if(!this.shielded){this.hp-=o.dmg;this.burstP(o.x,o.y,o.color,14)}
        else{this.burstP(o.x,o.y,'#b388ff',10);toast('üõ°Ô∏è –©–∏—Ç –ø–æ–≥–ª–æ—Ç–∏–ª —É—Ä–æ–Ω!','shield')}
        this.orbs.splice(i,1);
        this.combo=1;this.wrong++;
        if(this.hp<=0){this.hp=0;this.end()}
        this.hud();continue;
      }
      this.drawOrb(o);
    }

    // Particles
    for(let i=this.particles.length-1;i>=0;i--){
      const p=this.particles[i];p.x+=p.vx;p.y+=p.vy;p.life--;p.vy+=.04;
      if(p.life<=0){this.particles.splice(i,1);continue}
      const a=p.life/p.ml;gx.globalAlpha=a;gx.fillStyle=p.c;gx.beginPath();gx.arc(p.x,p.y,p.s*a,0,6.28);gx.fill();
    }gx.globalAlpha=1;

    // Floats
    for(let i=this.floats.length-1;i>=0;i--){
      const f=this.floats[i];f.y-=1.1;f.life--;
      if(f.life<=0){this.floats.splice(i,1);continue}
      const a=f.life/f.ml;gx.globalAlpha=a;gx.font=`900 ${f.sz}px Orbitron`;gx.textAlign='center';
      gx.shadowColor=f.c;gx.shadowBlur=8;gx.fillStyle=f.c;gx.fillText(f.t,f.x,f.y);gx.shadowBlur=0;
    }gx.globalAlpha=1;

    // Credit watermark
    gx.globalAlpha=.12;gx.font='11px Exo 2';gx.textAlign='center';
    gx.fillStyle='#fff';gx.fillText('Caspian BrainStorm ‚Ä¢ –ö–∞—Å–ø–∏–π—Å–∫–∏–π –ö–æ–ª–ª–µ–¥–∂ ‚Ä¢ –¢–ª–µ—É–±–µ–∫–æ–≤ –ê.–ì.',W/2,H-12);
    gx.globalAlpha=1;

    requestAnimationFrame(()=>this.loop());
  },

  drawCore(){
    const t=this.time*.003;const hpR=this.hp/100;const pulse=1+.025*Math.sin(t*3);const r=this.coreR*pulse;

    // Outer glow
    const g1=gx.createRadialGradient(this.cx,this.cy,r*.3,this.cx,this.cy,r*3);
    g1.addColorStop(0,hpR>.5?'rgba(29,233,182,.08)':'rgba(255,0,98,.08)');g1.addColorStop(1,'transparent');
    gx.fillStyle=g1;gx.beginPath();gx.arc(this.cx,this.cy,r*3,0,6.28);gx.fill();

    // Shield visual
    if(this.shielded){
      gx.beginPath();gx.arc(this.cx,this.cy,r*1.6,0,6.28);
      gx.strokeStyle=`rgba(179,136,255,${.3+.15*Math.sin(t*5)})`;gx.lineWidth=3;gx.setLineDash([8,6]);gx.stroke();gx.setLineDash([]);
    }

    // Ring
    gx.beginPath();gx.arc(this.cx,this.cy,r*1.35,0,6.28);
    gx.strokeStyle=hpR>.5?`rgba(29,233,182,${.12+.04*Math.sin(t*4)})`:`rgba(255,0,98,${.15+.08*Math.sin(t*6)})`;
    gx.lineWidth=1.5;gx.stroke();

    // Orbiting dots
    for(let i=0;i<6;i++){
      const a=t*2+i*(Math.PI/3);const ox=this.cx+Math.cos(a)*r*1.35;const oy=this.cy+Math.sin(a)*r*1.35;
      gx.beginPath();gx.arc(ox,oy,2.5,0,6.28);gx.fillStyle=hpR>.5?'rgba(29,233,182,.5)':'rgba(255,0,98,.5)';gx.fill();
    }

    // Core sphere
    const cg=gx.createRadialGradient(this.cx-r*.2,this.cy-r*.2,0,this.cx,this.cy,r);
    if(hpR>.6){cg.addColorStop(0,'#1de9b6');cg.addColorStop(.6,'#00897b');cg.addColorStop(1,'#004d40')}
    else if(hpR>.3){cg.addColorStop(0,'#ffa726');cg.addColorStop(.6,'#e65100');cg.addColorStop(1,'#4e1800')}
    else{cg.addColorStop(0,'#ff1744');cg.addColorStop(.6,'#b71c1c');cg.addColorStop(1,'#3e0000')}
    gx.fillStyle=cg;gx.beginPath();gx.arc(this.cx,this.cy,r,0,6.28);gx.fill();

    // Shine
    gx.beginPath();gx.arc(this.cx-r*.15,this.cy-r*.2,r*.35,0,6.28);
    gx.fillStyle='rgba(255,255,255,.12)';gx.fill();

    // Emoji
    gx.font=`${Math.floor(r*.7)}px sans-serif`;gx.textAlign='center';gx.textBaseline='middle';
    gx.fillText('üß†',this.cx,this.cy);

    // HP
    gx.font=`800 ${Math.floor(Math.min(14,r*.4))}px Orbitron`;gx.fillStyle='rgba(255,255,255,.8)';
    gx.fillText(`${Math.ceil(this.hp)}%`,this.cx,this.cy+r+16);
  },

  drawOrb(o){
    const p=1+.06*Math.sin(o.pulse*3.5);const r=o.r*p;

    // Glow
    const g=gx.createRadialGradient(o.x,o.y,0,o.x,o.y,r*2);
    g.addColorStop(0,o.color.replace(')',`,.1)`).replace('rgb','rgba'));g.addColorStop(1,'transparent');
    gx.fillStyle=g;gx.beginPath();gx.arc(o.x,o.y,r*2,0,6.28);gx.fill();

    // Rotating ring
    gx.save();gx.translate(o.x,o.y);gx.rotate(o.rot);
    gx.beginPath();gx.ellipse(0,0,r*1.3,r*.5,0,0,6.28);
    gx.strokeStyle=o.color;gx.globalAlpha=.25;gx.lineWidth=1.5;gx.stroke();gx.globalAlpha=1;gx.restore();

    // Body
    const sg=gx.createRadialGradient(o.x-r*.2,o.y-r*.2,0,o.x,o.y,r);
    sg.addColorStop(0,'rgba(255,255,255,.2)');sg.addColorStop(.5,o.color);sg.addColorStop(1,o.darkColor||o.color);
    gx.fillStyle=sg;gx.shadowColor=o.color;gx.shadowBlur=12;
    gx.beginPath();gx.arc(o.x,o.y,r,0,6.28);gx.fill();gx.shadowBlur=0;

    // Icon
    gx.font=`${Math.floor(r*.8)}px sans-serif`;gx.textAlign='center';gx.textBaseline='middle';
    gx.fillText(o.icon,o.x,o.y);

    // HP bar for tough orbs
    if(o.maxHp>1){
      const bw=r*2.4,bh=4;
      gx.fillStyle='rgba(0,0,0,.5)';gx.fillRect(o.x-bw/2,o.y-r-10,bw,bh);
      gx.fillStyle=o.color;gx.fillRect(o.x-bw/2,o.y-r-10,bw*(o.hp/o.maxHp),bh);
    }
  },

  spawnOrb(){
    const W=innerWidth,H=innerHeight;
    const side=Math.floor(rnd(0,4));
    let x,y;
    const margin=40;
    if(side===0){x=rnd(margin,W-margin);y=-margin}
    else if(side===1){x=W+margin;y=rnd(margin,H-margin)}
    else if(side===2){x=rnd(margin,W-margin);y=H+margin}
    else{x=-margin;y=rnd(margin,H-margin)}

    const w=this.wave;
    const baseSpd=rnd(.35,.55)+w*.04;
    const col=COLORS[Math.floor(rnd(0,COLORS.length))];
    const icon=ICONS[Math.floor(rnd(0,ICONS.length))];
    let hp=1,dmg=8,r=22,pts=40;
    if(w>=3&&Math.random()<.3){hp=2;dmg=12;r=28;pts=60}
    if(w>=6&&Math.random()<.2){hp=3;dmg=18;r=34;pts=90}
    if(w>=9&&Math.random()<.15){hp=4+Math.floor(w/5);dmg=22;r=38;pts=120}

    this.orbs.push({x,y,r,speed:Math.min(baseSpd,2.5),hp,maxHp:hp,dmg,pts,color:col,icon,pulse:rnd(0,6),rot:rnd(0,6),darkColor:col});
  },

  nextWave(){
    this.wave++;this.waveN=0;
    this.waveMax=Math.min(6+this.wave*2,30);
    this.spawnI=Math.max(30,110-this.wave*6);
    this.waveDelay=150;
    const subs=['–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å!','–°–ª–æ–∂–Ω–µ–µ!','–ù–µ —Å–¥–∞–≤–∞–π—Ç–µ—Å—å!','–ë—ã—Å—Ç—Ä–µ–µ!','–í—ã —Å–∏–ª—å–Ω—ã!','–ú–æ–∑–≥–∏ –∫–∏–ø—è—Ç!','–ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ!','–õ–µ–≥–µ–Ω–¥–∞!'];
    waveBanner(this.wave,subs[Math.min(this.wave-2,subs.length-1)]||'üí™');
    this.hp=Math.min(100,this.hp+3);this.hud();
  },

  getQuestion(){
    let pool=Q.filter((_,i)=>!this.usedQ.has(i));
    if(pool.length<4)this.usedQ.clear();
    pool=Q.filter((_,i)=>!this.usedQ.has(i));
    const idx=Math.floor(rnd(0,pool.length));
    const realIdx=Q.indexOf(pool[idx]);
    this.usedQ.add(realIdx);
    return Q[realIdx];
  },

  click(px,py){
    if(this.paused||!this.on)return;
    // find closest orb within range
    let best=-1,bestD=Infinity;
    for(let i=0;i<this.orbs.length;i++){
      const o=this.orbs[i];
      const d=dst({x:px,y:py},o);
      if(d<o.r*2.8&&d<bestD){bestD=d;best=i}
    }
    if(best>=0){this.openQuiz(best)}
  },

  openQuiz(orbIdx){
    this.paused=true;
    const orb=this.orbs[orbIdx];
    const wrap=$('qWrap');wrap.classList.remove('off');
    const q=this.getQuestion();
    const bonus=orb.pts+this.wave*5;

    $('qCat').textContent=q.c;$('qPts').textContent=`+${bonus*this.combo}`;
    $('qTxt').textContent=q.q;$('qFb').style.display='none';

    const grid=$('qGrid');grid.innerHTML='';grid.style.pointerEvents='auto';
    let done=false,tv=100;
    const bar=$('qBar');bar.style.width='100%';

    const iv=setInterval(()=>{tv-=.4;bar.style.width=tv+'%';if(tv<=0){clearInterval(iv);if(!done){done=true;result(false,-1)}}},50);

    const result=(ok,idx)=>{
      grid.style.pointerEvents='none';clearInterval(iv);
      const fb=$('qFb');fb.style.display='block';

      if(ok){
        fb.textContent='‚úÖ –í–ï–†–ù–û!';fb.style.color='var(--lime)';
        this.correct++;
        // damage orb
        orb.hp--;
        this.burstP(orb.x,orb.y,orb.color,10);
        const pts=bonus*this.combo;
        this.score+=pts;
        this.floats.push({x:orb.x,y:orb.y,t:`+${pts}`,c:orb.color,sz:Math.min(24,14+this.combo*2),life:55,ml:55});
        this.combo=Math.min(this.combo+1,10);this.maxCombo=Math.max(this.maxCombo,this.combo);

        if(orb.hp<=0){this.burstP(orb.x,orb.y,orb.color,25);this.orbs.splice(orbIdx,1)}

        // Powerups every 3 combo
        if(this.combo>1&&this.combo%3===0){
          const pw=Math.random();
          if(pw<.3){this.hp=Math.min(100,this.hp+12);toast('üíö +12 HP!','heal')}
          else if(pw<.55){this.frozen=true;this.freezeT=350;toast('‚ùÑÔ∏è –ó–∞–º–æ—Ä–æ–∑–∫–∞ 6 —Å–µ–∫!','freeze')}
          else if(pw<.75){
            const n=this.orbs.length;this.orbs.forEach(o=>this.burstP(o.x,o.y,o.color,8));
            this.score+=n*25;this.orbs=[];toast(`üí• –í–∑—Ä—ã–≤! +${n*25}!`,'nuke');
          }else{this.shielded=true;this.shieldT=400;toast('üõ°Ô∏è –©–∏—Ç –Ω–∞ 7 —Å–µ–∫!','shield')}
        }
      }else{
        fb.textContent='‚ùå –ù–ï–í–ï–†–ù–û!';fb.style.color='var(--mag)';
        this.wrong++;this.combo=1;
        // orb speeds up
        orb.speed=Math.min(orb.speed*1.3,3);
      }

      if(idx>=0){grid.children[idx].classList.add(ok?'ok':'no')}
      grid.children[q.a].classList.add('ok');

      setTimeout(()=>{
        wrap.classList.add('off');this.paused=false;this.hud();
        if(this.hp<=0)this.end();
        else requestAnimationFrame(()=>this.loop());
      },1000);
    };

    q.o.forEach((opt,idx)=>{
      const btn=document.createElement('button');btn.className='qo';btn.textContent=opt;
      btn.onclick=()=>{if(done)return;done=true;result(idx===q.a,idx)};
      grid.appendChild(btn);
    });
  },

  burstP(x,y,c,n){for(let i=0;i<n;i++)this.particles.push({x,y,vx:rnd(-3.5,3.5),vy:rnd(-4.5,1),s:rnd(2,5),c,life:rnd(22,42),ml:42})},

  hud(){
    $('hScore').textContent=this.score;
    $('hWave').textContent=this.wave;
    $('hCombo').textContent=`x${this.combo}`;
    $('hCombo').style.color=this.combo>=5?'#76ff03':this.combo>=3?'#ffd600':this.combo>=2?'#40c4ff':'rgba(255,255,255,.4)';
    const bar=$('hpBar');bar.style.width=Math.max(0,this.hp)+'%';
    bar.className='energy-fill'+(this.hp<25?' low':this.hp<50?' mid':'');
  },

  end(){
    this.on=false;
    const total=this.correct+this.wrong;
    const acc=total>0?Math.round(this.correct/total*100):0;
    $('goSc').textContent=this.score+' –û–ß–ö–û–í';
    $('goW').textContent=this.wave;$('goK').textContent=this.correct;
    $('goX').textContent='x'+this.maxCombo;$('goA').textContent=acc+'%';
    $('goInput').value='';$('qWrap').classList.add('off');
    $('gameArea').style.display='none';
    $('gameover').classList.remove('off');
  },

  save(){
    const n=$('goInput').value.trim()||'–ê–Ω–æ–Ω–∏–º';
    const lb=getLB();
    lb.push({n,s:this.score,w:this.wave,d:new Date().toLocaleDateString('ru-RU')});
    lb.sort((a,b)=>b.s-a.s);saveLB(lb.slice(0,60));
    showScr('lb');
  }
};

// ==================== INPUT ====================
gc.addEventListener('pointerdown',e=>{e.preventDefault();const r=gc.getBoundingClientRect();G.click(e.clientX-r.left,e.clientY-r.top)});
document.addEventListener('keydown',e=>{if(e.code==='Escape')G.pause()});
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});

showScr('menu');
</script>
</body>
</html>
